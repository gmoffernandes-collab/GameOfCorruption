<script>
  let score = 0;       // Honestidade
  let popularity = 0;  // Corrupção
  let phase = 1;

  const clickSound = document.getElementById('click-sound');
  const endSound = document.getElementById('end-sound');
  const bgMusic = document.getElementById('bg-music');

  bgMusic.volume = 0.2;
  bgMusic.play().catch(() => {});

  function updateStats(changeScore = 0, changePop = 0) {
    score += changeScore;
    popularity += changePop;

    // Sempre limitar a 0–100
    score = Math.min(Math.max(score, 0), 100);
    popularity = Math.min(Math.max(popularity, 0), 100);

    document.getElementById("score").textContent = score;
    document.getElementById("popularity").textContent = popularity;
    document.getElementById("power-bar").style.width = score + "%";
    document.getElementById("popularity-bar").style.width = popularity + "%";
  }

  function gameOver(message) {
    document.getElementById("choices").innerHTML = "";
    document.getElementById("game-over").innerHTML =
      `<br><strong>${message}</strong><br><br><button onclick="location.reload()">Play Again</button>`;
    endSound.play();
  }

  function choose(option) {
    clickSound.play();
    const story = document.getElementById("story");
    const choices = document.getElementById("choices");

    /* ===================== PHASE 1 ===================== */
    if (phase === 1) {
      if (option === 'honest') {
        story.innerHTML = "If necessary, I will do it even if it is unpopular.";
        updateStats(+10, 0);  // HONESTO
        choices.innerHTML = `
          <button onclick="choose('resist')">Resist the pressure</button>
          <button onclick="choose('negotiate')">Negotiate with elites</button>`;
      } else if (option === 'corrupt') {
        story.innerHTML = "I decide what is right";
        updateStats(0, +10);  // CORRUPTO
        choices.innerHTML = `
          <button onclick="choose('bribe')">Bribe journalists</button>
          <button onclick="choose('confess')">Publicly admit your mistakes</button>`;
      }
      phase = 2;
    }

    /* ===================== PHASE 2 ===================== */
    else if (phase === 2) {
      if (option === 'resist') {
        story.innerHTML = "You stand firm and expose corruption schemes.";
        updateStats(+15, 0);  // HONESTO
        choices.innerHTML = `
          <button onclick="choose('election')">Run for reelection</button>
          <button onclick="choose('resign')">Resign to avoid retaliation</button>`;
        phase = 3;
      }
      else if (option === 'negotiate') {
        story.innerHTML = "You make political concessions to survive.";
        updateStats(0, +15);  // CORRUPTO
        choices.innerHTML = `
          <button onclick="choose('help')">Launch a social program</button>
          <button onclick="choose('ignore')">Ignore the crisis</button>`;
        phase = 3;
      }
      else if (option === 'bribe') {
        updateStats(0, +40);  // CORRUPTO
        gameOver("The scandal explodes! You’re arrested. Ending: The National Scandal.");
      }
      else if (option === 'confess') {
        updateStats(+20, 0);  // HONESTO
        story.innerHTML = "Your honesty surprises everyone.";
        choices.innerHTML = `
          <button onclick="choose('campaign')">Run again</button>
          <button onclick="choose('retire')">Leave politics</button>`;
        phase = 3;
      }
    }

    /* ===================== PHASE 3 ===================== */
    else if (phase === 3) {
      if (option === 'election') {
        story.innerHTML = "Your campaign grows strong.";
        updateStats(+10, 0);  // HONESTO
        choices.innerHTML = `
          <button onclick="choose('debate')">Confront them in a debate</button>
          <button onclick="choose('counterattack')">Use fake news yourself</button>`;
        phase = 4;
      }
      else if (option === 'resign') {
        gameOver("You resign with dignity. Ending: The Idealist.");
      }
      else if (option === 'help') {
        story.innerHTML = "You launch emergency aid.";
        updateStats(+10, 0);  // HONESTO
        choices.innerHTML = `
          <button onclick="choose('raise-taxes')">Raise taxes</button>
          <button onclick="choose('print-money')">Print more money</button>`;
        phase = 4;
      }
      else if (option === 'ignore') {
        updateStats(0, +25);  // CORRUPTO
        gameOver("The crisis destroys the nation. Ending: The Negligent.");
      }
      else if (option === 'campaign') {
        story.innerHTML = "You return stronger.";
        updateStats(+20, 0);  // HONESTO
        choices.innerHTML = `
          <button onclick="choose('win-election')">Win the election</button>
          <button onclick="choose('lose-election')">Lose the election</button>`;
        phase = 4;
      }
      else if (option === 'retire') {
        gameOver("You leave politics. Ending: The Mentor.");
      }
    }

    /* ===================== PHASE 4 ===================== */
    else if (phase === 4) {
      if (option === 'debate') {
        updateStats(+20, 0);
        gameOver("You win the debate! Ending: The People's Leader.");
      }
      else if (option === 'counterattack') {
        updateStats(0, +20);
        gameOver("You win, but destroy the truth. Ending: The Manipulator.");
      }
      else if (option === 'raise-taxes') {
        updateStats(+10, 0);
        gameOver("The country recovers. Ending: The Reformer.");
      }
      else if (option === 'print-money') {
        updateStats(0, +30);
        gameOver("Inflation explodes. Ending: The Economic Disaster.");
      }
      else if (option === 'win-election') {
        updateStats(+25, 0);
        gameOver("You return to power. Ending: Redemption.");
      }
      else if (option === 'lose-election') {
        updateStats(+10, 0);
        gameOver("You lose with dignity. Ending: The Fallen Hero.");
      }
    }
  }
</script>
